# 複合フィルター機能実装記録

## 実装日
2025年10月10日

## 実装した機能
- 優先度フィルター（高・中・低）
- 複合フィルター（検索 + ステータス + 優先度の同時適用）

## 学んだ重要な概念

### 1. enum の仕組み
```ruby
# モデル（app/models/task.rb）
enum status: { not_started: 0, in_progress: 1, completed: 2 }
enum priority: { low: 0, medium: 1, high: 2 }
```
- データベースには数字で保存（効率的）
- アプリでは文字列で表示（分かりやすい）

### 2. URLパラメータの制限と解決
**問題：** `case`文では一つの値しか判定できない
```ruby
# 問題のあるコード
case params[:filter]
when 'completed'  # 一つだけ
when 'high'       # 一つだけ
end
```

**解決：** 別々のパラメータを使用
```ruby
# 改良後のコード
@tasks = @tasks.where(status: params[:status]) if params[:status].present?
@tasks = @tasks.where(priority: params[:priority]) if params[:priority].present?
```

### 3. MVC連携の理解
```
ビュー（ERB）
tasks_path(status: 'completed')
        ↓
URL生成
/tasks?status=completed
        ↓
コントローラー
params[:status] = "completed"
        ↓
データベースクエリ
@tasks.where(status: params[:status])
```

### 4. 実用的な問題解決
- `incomplete`は実際のデータベース値ではない
- `not_started`と`in_progress`に分けて実装
- ユーザーにとってより分かりやすいUI

## 実装したコード

### コントローラー（tasks_controller.rb）
```ruby
# 複数フィルターの同時適用
@tasks = @tasks.where(status: params[:status]) if params[:status].present?
@tasks = @tasks.where(priority: params[:priority]) if params[:priority].present?
```

### ビュー（index.html.erb）
```erb
<%= link_to "未着手", tasks_path(status: 'not_started'), class: "btn btn-secondary" %>
<%= link_to "進行中", tasks_path(status: 'in_progress'), class: "btn btn-warning" %>
<%= link_to "完了", tasks_path(status: 'completed'), class: "btn btn-success" %>
<%= link_to "高", tasks_path(priority: 'high'), class: "btn btn-danger" %>
<%= link_to "中", tasks_path(priority: 'medium'), class: "btn btn-warning" %>
<%= link_to "低", tasks_path(priority: 'low'), class: "btn btn-secondary" %>
```

## 動作確認
- ✅ 単体フィルター動作確認
- ✅ 複合フィルター動作確認（手動URL）
- ✅ 検索 + ステータス + 優先度の同時適用

## 実用できる組み合わせ例
```
/tasks?search=料理&status=in_progress&priority=high
→ 「料理」を含む、進行中の高優先度タスク
```

## 次回の課題
- URL状態の保存（ブックマーク機能）
- ページネーション機能
- より高度なUI（チェックボックス形式など）

## 学習のポイント
1. **段階的理解**: 既存パターンを理解してから応用
2. **問題発見力**: データと実装の不一致を発見
3. **柔軟な設計変更**: より良い方法への変更判断
4. **実用性重視**: ユーザー目線での改善